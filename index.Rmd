---
title: "Income Level and Focus of School Districts"
author: "Michelle Jiang"
description: "An analysis on the effect of neighborhood income on the focus of the local school district through inspecting school district mission statements"
output:
  distill::distill_article:
    self_contained: false
---


```{r}
library(tidyverse) 

install.packages("wesanderson")
library(wesanderson)

statement <- read.csv("district_tabular_data.csv")
```

## Introduction

Though the United States offers free public education, the quality of education varies across different states, counties, and even neighborhoods. One of the greatest determinants of the quality of a public school and the resources it can provide is the median income of the area it is located in. This project aims to understand how neighborhood income affects the focus of the school district by looking at their mission statements, especially a schoolâ€™s attention toward future readiness, developing academic skills, and parent and community involvement. Since higher-income schools have more resources and tend to send more students to elite colleges and universities, I hypothesize that school districts located in higher-income neighborhoods are more focused on future readiness, developing academic skills, and parent and community involvement than schools located in middle-income and low-income neighborhoods. If it is observed that these topics are mentioned more often in the mission statement of schools in high-income neighborhoods, there is support for my hypothesis. However, my hypothesis would be disproved if there is no relationship between income level and mention of those topics in the school district mission statements or if the topics are mentioned more by schools located in middle or low-income neighborhoods. Through this project, we will gain a better understanding on how income can affect the quality of schooling one gets in the United States. 

## Data OVerview

```{r}
future_plot <- statement |>
  mutate(future_readiness = 
           if_else(topic_future_readiness == 1, "Mentioned", "Not Mentioned")) |>
  ggplot(aes(x = future_readiness)) + 
  geom_bar(mapping = aes(fill = future_readiness)) +
  labs(
    x = "Future Readiness in School District Mission Statements",
    y = "Number of School Districts",
    title = "Mention of Future Readiness in School District Mission Statements"
  ) +
  theme(legend.position = "none") +
  scale_fill_manual(values = wes_palette("Moonrise3"))

future_plot
```


```{r}
academic_plot <- statement |>
  mutate(academic_skills = 
           if_else(topic_developing_academic_skills == 1, "Mentioned", "Not Mentioned")) |>
  ggplot(aes(x = academic_skills)) + 
  geom_bar(mapping = aes(fill = academic_skills)) +
  labs(
    x = "Development of Academic Skills in School District Mission Statements",
    y = "Number of School Districts",
    title = "Mention of Developing Academic Skills in School District Mission Statements"
  ) +
  theme(legend.position = "none") +
  scale_fill_manual(values = wes_palette("Moonrise3"))

academic_plot
```


```{r}
parent_plot <- statement |>
  mutate(parent_involvement = 
           if_else(topic_parent_and_community_involvement == 1, "Mentioned", "Not Mentioned")) |>
  ggplot(aes(x = parent_involvement)) + 
  geom_bar(mapping = aes(fill = parent_involvement)) +
  labs(
    x = "Parent and Community Involvement in School District Mission Statements",
    y = "Number of School Districts",
    title = "Mention of Parent and Community Involvement 
    in School District Mission Statements"
  ) +
  theme(legend.position = "none") +
  scale_fill_manual(values = wes_palette("Moonrise3"))

parent_plot
```

## Results 


```{r}
plot1 <- statement |>
  group_by(hh_median_income_category) |>
  summarize(mean_intellectual = mean(word_intellectual)) |>
  ggplot(mapping = aes(x = hh_median_income_category, y = mean_intellectual)) + 
  geom_col(fill = "lightpink") +
  labs(
    x = "Median Income of Neighborhood",
    y = "Proportion of School Statement that Mention 'Intellectual'",
    title = "Occurances of the word 'Intellectual' in School Statements Based 
    on Neighborhood Income"
  ) +
  coord_cartesian(ylim = c(0, 0.15))

plot1
```

## Analysis (Milestone 4)

```{r}
statement |>
  group_by(hh_median_income_category, white_share_category) |>
  summarize(n = n()) |>
  mutate(prop = n/sum(n))
```

In this chunck, I checked how balanced the different income groups are by looking at the proportion of white people in each income group. The proportions are roughly balanced across the different income groups, which means that we can treat the treatment as randomly assigned and procede with the observational study. 

```{r}
ate_high_income <- statement |>
  filter(hh_median_income_category != "low_median_income") |>
  mutate(
    treatment = 
      if_else(hh_median_income_category == "high_median_income", "Treatment", "Control")) |>
  group_by(treatment, white_share_category) |>
  summarize(mean_intellectual = mean(word_intellectual)) |>
  pivot_wider(
    names_from = treatment,
    values_from = mean_intellectual
  ) |>
  mutate(ATE = Treatment - Control)

knitr::kable(ate_high_income, col.names = c("Proportion White", "Control", "Treatment", "ATE"))
```

```{r}
ate_low_income <- statement |>
  filter(hh_median_income_category != "high_median_income") |>
  mutate(
    treatment = 
      if_else(hh_median_income_category == "low_median_income", "Treatment", "Control")) |>
  group_by(treatment, white_share_category) |>
  summarize(mean_intellectual = mean(word_intellectual)) |>
  pivot_wider(
    names_from = treatment,
    values_from = mean_intellectual
  ) |>
  mutate(ATE = Treatment - Control)

knitr::kable(ate_low_income, col.names = c("Proportion White", "Control", "Treatment", "ATE"))
```

In the previous two chunks, I found the average treatment effect of a school district's income level on the prevalence of the word "intellectual" in the school district statement. I treated the median income group as the control group and the high and low income group as treatment A and treatment B respectively. I also sorted the income groups based on the proportion of white people in the community. Regarding the treatment of having high median income, the average treatment effect on the prevalence of the word "intellectual" is slight highter in communities with a lower share of white residents. 

```{r}
ate_low_income_urban <- statement |>
  filter(hh_median_income_category != "high_median_income") |>
  mutate(
    treatment = 
      if_else(hh_median_income_category == "low_median_income", "Treatment", "Control")) |>
  group_by(treatment, urbanicity) |>
  summarize(mean_intellectual = mean(word_intellectual)) |>
  pivot_wider(
    names_from = treatment,
    values_from = mean_intellectual
  ) |>
  mutate(ATE = Treatment - Control)

knitr::kable(ate_low_income_urban, col.names = c("Geographical Area", "Control (Medium Income)","Treatment (Low Income)","ATE"))
```

```{r}
ate_high_income_urban <- statement |>
  filter(hh_median_income_category != "low_median_income") |>
  mutate(
    treatment = 
      if_else(hh_median_income_category == "high_median_income", "Treatment", "Control")) |>
  group_by(treatment, urbanicity) |>
  summarize(mean_intellectual = mean(word_intellectual)) |>
  pivot_wider(
    names_from = treatment,
    values_from = mean_intellectual
  ) |>
  mutate(ATE = Treatment - Control)

knitr::kable(ate_high_income_urban, col.names = c("Geographical Area", "Control (Medium Income)","Treatment (High Income)","ATE"))
```

For this part, I grouped the income groups by the geographical area and found the average treatment effect. I found that the treatment of having a low median income has the highest average treatment effect on rural areas, resulting in an average of 3.33% decrease in the prevalence of the word "intellectual" in the school district statement. With the treatment of having a high median income, the average treatment effect is highest in suburban areas, resuling in an avergae of 6.94% increase in the prevalence of the word "intellectual" in school district statements. 

```{r}
avg_cat <- statement |>
  summarize(
    across(topic_academic_program:word_extracurricular, mean)
  )
```

```{r}
ate_academic_high_income <- statement |>
  filter(hh_median_income_category != "low_median_income") |>
  group_by(hh_median_income_category, urbanicity) |>
  summarize(mean_academic = mean(topic_academic_program)) |>
  pivot_wider(
    names_from = hh_median_income_category,
    values_from = mean_academic
  ) |>
  mutate(ATE = high_median_income - medium_median_income)

knitr::kable(ate_academic_high_income, col.names = c("Geographical Area", "Treatment (High Income)", "Control (Medium Income)","ATE"))
```

```{r}
ate_academic_low_income <- statement |>
  filter(hh_median_income_category != "high_median_income") |>
  group_by(hh_median_income_category, urbanicity) |>
  summarize(mean_academic = mean(topic_academic_program)) |>
  pivot_wider(
    names_from = hh_median_income_category,
    values_from = mean_academic
  ) |>
  mutate(ATE = low_median_income - medium_median_income)

knitr::kable(ate_academic_low_income, col.names = c("Geographical Area", "Treatment (Low Income)", "Control (Medium Income)","ATE"))
```

In this last analysis, I looked at the effect of income on the prevalence of the topic of academic programs in school district statments grouped by geographical areas. The treatment of having a high median income has the largest average treatment effect in rural areas. Among urban areas, there is virtually no difference between neighborhoods with high median income (treatment) or medium median income (control) in terms of how much the topic of academic programs show up in the school district statement. The treatment of having a low median income has the largest average treatment effect in suburban areas. Among rural areas, there is virtually no difference between neighborhoods with low median income (treatment) or medium median income (control). 